<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/show.css" />
<%- include('../partials/nav') %>

<main>
  <% if (game.owner.equals(user?.profile._id)) { %>
    <a href="/games/<%= game._id %>/edit">
      <button class="btn" id="edit-btn">Edit</button>
    </a>
  <% } %>
  <img src="<%= game.imgUrl %>" alt="<%= game.name %>">
  <h1><%= game.name %></h1>
  <table>
    <tr>
      <td>Released <%= game.year %></td>
      <td>Categories <%= game.category %></td>
      <td>Complexity <%= game.complexity %></td>
    </tr>
    <tr>
      <td><%= game.online ? 'Available online!' : 'Not Online'%></td>
      <td>Players <%= game.minPlayers %> - <%= game.maxPlayers %></td>
      <td>Strategy <%= game.strategy %></td>
    </tr>
    <tr>
      <td>Created by <%= game.owner.name  %></td>
      <td>Game Play <%= game.duration %></td>
      <td>Luck <%= game.luck %></td>
    </tr>
  </table>

  <section>
    <h2>Reviews</h2>
    <% if (user) { %>
      <h3>Add a review</h3>
      <form action="/games/<%= game._id %>/reviews" method="POST">
        <label for="rating-input">Rate:</label>
        <select name="rating" id="rating-input" >
          <% ratingOptions.forEach(score => { %>
            <option value="<%= score %>"><%= score %></option>
          <% }) %>
        </select><br>
        <textarea name="content" id="review-input" ></textarea><br>
        <button id="review-btn">Post Review</button>
      </form>
    <% } %>
    <ul>
      <% game.reviews?.forEach(review => { %>
        <li> <%= review.rating %> - <%= review.content %> - <%= review.author.name %> </li> 
        <% if (review.author.equals(user?.profile._id)) { %>
          <a href="/games/<%= game._id %>/reviews/<%= review._id %>/edit">
            <button class="btn">Edit Comment</button>
          </a>
        <% } %> 
      <% }) %>
    </ul>
  </section>


</main>

<%- include('../partials/footer') %>
