<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/games/show.css" />
<%- include('../partials/nav') %>

<main>
  <section class="game-image">
    <img src="<%= game.imgUrl %>" alt="<%= game.name %>">
  </section>

  <section class="game-header">
    <div class="name-fav-edit">
      <h1><%= game.name %></h1>
      <% if (user) { %>
        <form action="/profiles/games/<%= game._id %>" method="POST">
          <button>
            <i class="fa-solid fa-heart-circle-plus fa-xl"></i>
          </button>
        </form>
      <% } %>
      <% if (game.owner.equals(user?.profile._id)) { %>
        <a href="/games/<%= game._id %>/edit">
          <button>
            <i class="fa-solid fa-pen-to-square fa-xl"></i>
          </button>
        </a>
      <% } %>
    </div>
    <div class="avgRating">
      <% if (game.totReviews) { %>
        <h3><%= game.avgRating %></h3>
        <h3>(<%= game.totReviews %> reviews)</h3>
      <% } %>
    </div>
  </section>

  <section class="left">
    <p>Released <%= game.year %></p>
    <p><%= game.online ? 'Play online!' : 'Not online'%></p>
    <p>Posted by <%= game.owner.name %></p>
  </section>

  <section class="middle">
    <div>
      <p>Category</p>
      <span class="label category"><%= game.category %></span> 
    </div>
    
    <div>
      <i class="fa-solid fa-user-group fa-lg"></i>
      <p><%= game.minPlayers %> - <%= game.maxPlayers %></p>
    </div>

    <div>
      <i class="fa-solid fa-clock fa-lg"></i>
      <p><%= game.duration %></p>  
    </div>
  </section>

  <section class="right">
    <p>Complexity <%= game.complexity %> / 5</p>
  

    <span class="label category"><%= game.category %></span>

    <p>Strategy <%= game.strategy %> / 5</p>
    <p>Luck <%= game.luck %> / 5</p>
  </section>
    
  <section class="reviews">
    <h2>Reviews</h2>
    <% if (user) { %>
      <h3>Add a review</h3>
      <form action="/games/<%= game._id %>/reviews" method="POST">
        <label for="rating-input">Rate:</label>
        <select name="rating" id="rating-input" >
          <% ratingOptions.forEach(score => { %>
            <option value="<%= score %>"><%= score %></option>
          <% }) %>
        </select><br>
        <textarea type="text" name="content" id="review-input" autocomplete="off"></textarea><br>
        <button id="review-btn">Post Review</button>
      </form>
    <% } %>
    <ul>
      <% game.reviews?.forEach(review => { %>
        <li> <%= review.rating %> - <%= review.content %> - <%= review.author.name %> </li> 
        <% if (review.author.equals(user?.profile._id)) { %>
          <a href="/games/<%= game._id %>/reviews/<%= review._id %>/edit">
            <button class="btn">Edit Comment</button>
          </a>
          <form action="/games/<%= game._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
            <button type="submit" id="delete-btn">Delete Comment</button>
          </form>
        <% } %> 
      <% }) %>
    </ul>
  </section>


</main>

<%- include('../partials/footer') %>
